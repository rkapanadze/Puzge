<div class="products-page">
  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <h1>{{ languageService.getCurrentLanguage() === 'ka' ? 'პროდუქტები' : 'Products' }}</h1>
      <p>{{ languageService.getCurrentLanguage() === 'ka' ? 'აღმოაჩინეთ ჩვენი პაზლების, სამაგიდო და ბანქოს თამაშების კოლექცია' : 'Discover our collection of puzzles, board games, and card games' }}</p>
    </div>

    <!-- Search Bar -->
    <div class="search-section">
      <div class="search-container">
        <input
          type="text"
          [(ngModel)]="searchQuery"
          (input)="onSearchChange()"
          [placeholder]="languageService.getCurrentLanguage() === 'ka' ? 'ძიება...' : 'Search...'"
          class="search-input">
        <button class="filter-toggle" (click)="toggleFilters()">
          <span>{{ languageService.getCurrentLanguage() === 'ka' ? 'ფილტრები' : 'Filters' }}</span>
          <span class="filter-icon" [class.active]="showFilters">▼</span>
        </button>
      </div>
    </div>

    <!-- Filters Section -->
    <div class="filters-section" [class.show]="showFilters">
      <div class="filters-container">

        <!-- Product Type Filter -->
        <div class="filter-group">
          <h3>{{ languageService.getCurrentLanguage() === 'ka' ? 'ტიპი' : 'Type' }}</h3>
          <div class="filter-options">
            <label class="filter-option">
              <input
                type="radio"
                [value]="null"
                [checked]="selectedType === null"
                (change)="onTypeChange(null)">
              <span>{{ languageService.getCurrentLanguage() === 'ka' ? 'ყველა' : 'All' }}</span>
            </label>
            <label class="filter-option" *ngFor="let type of productTypes">
              <input
                type="radio"
                [value]="type"
                [checked]="selectedType === type"
                (change)="onTypeChange(type)">
              <span>{{ getProductTypeDisplayText(type) }}</span>
            </label>
          </div>
        </div>

        <!-- Categories Filter -->
        <div class="filter-group">
          <h3>{{ languageService.getCurrentLanguage() === 'ka' ? 'კატეგორიები' : 'Categories' }}</h3>
          <div class="filter-options">
            <div class="category-filter" *ngFor="let category of categories">
              <label class="filter-option">
                <input
                  type="checkbox"
                  [checked]="isCategorySelected(category.id)"
                  (change)="onCategoryChange(category.id, $any($event.target).checked)">
                <span>{{ languageService.getLocalizedText(category.name) }}</span>
              </label>

              <!-- Subcategories -->
              <div class="subcategory-filters" *ngIf="isCategorySelected(category.id) && category.subcategories.length > 0">
                <label class="filter-option subcategory" *ngFor="let subcategory of category.subcategories">
                  <input
                    type="checkbox"
                    [checked]="isSubcategorySelected(subcategory.id)"
                    (change)="onSubcategoryChange(subcategory.id, $any($event.target).checked)">
                  <span>{{ languageService.getLocalizedText(subcategory.name) }}</span>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Clear Filters Button -->
        <button class="clear-filters-btn" (click)="clearFilters()">
          {{ languageService.getCurrentLanguage() === 'ka' ? 'ფილტრების გასუფთავება' : 'Clear Filters' }}
        </button>
      </div>
    </div>

    <!-- Results Summary -->
    <div class="results-summary">
      <p>
        {{ languageService.getCurrentLanguage() === 'ka' ? 'ნაპოვნია' : 'Found' }}
        <strong>{{ filteredProducts.length }}</strong>
        {{ languageService.getCurrentLanguage() === 'ka' ? 'პროდუქტი' : 'products' }}
      </p>
    </div>

    <!-- Products Grid -->
    <div class="products-grid" *ngIf="!isLoading">
      <div class="product-card" *ngFor="let product of filteredProducts">
        <div class="product-image">
          <img [src]="product.images[0] || '/assets/images/placeholder.jpg'"
               [alt]="languageService.getLocalizedText(product.name)"
               loading="lazy">
          <div class="product-type-badge">
            {{ getProductTypeDisplayText(product.type) }}
          </div>
        </div>

        <div class="product-info">
          <h3 class="product-name">{{ languageService.getLocalizedText(product.name) }}</h3>
          <p class="product-description">{{ languageService.getLocalizedText(product.description) }}</p>

          <!-- Categories Tags -->
          <div class="product-tags">
            <span class="tag" *ngFor="let category of product.categories">
              {{ languageService.getLocalizedText(category.name) }}
            </span>
          </div>

          <!-- Subcategories Tags -->
          <div class="product-subtags" *ngIf="product.subcategories.length > 0">
            <span class="subtag" *ngFor="let subcategory of product.subcategories">
              {{ languageService.getLocalizedText(subcategory.name) }}
            </span>
          </div>

          <!-- Product Specifications -->
          <div class="product-specs" *ngIf="product.specifications">
            <div class="spec" *ngIf="product.specifications.ageRange">
              <strong>{{ languageService.getCurrentLanguage() === 'ka' ? 'ასაკი:' : 'Age:' }}</strong>
              {{ product.specifications.ageRange }}
            </div>
            <div class="spec" *ngIf="product.specifications.playerCount">
              <strong>{{ languageService.getCurrentLanguage() === 'ka' ? 'მოთამაშეები:' : 'Players:' }}</strong>
              {{ product.specifications.playerCount }}
            </div>
            <div class="spec" *ngIf="product.specifications.playTime">
              <strong>{{ languageService.getCurrentLanguage() === 'ka' ? 'დრო:' : 'Time:' }}</strong>
              {{ product.specifications.playTime }}
            </div>
          </div>

          <!-- Availability -->
          <div class="availability" [class.available]="product.isAvailable">
            {{ product.isAvailable ?
            (languageService.getCurrentLanguage() === 'ka' ? 'ხელმისაწვდომია' : 'Available') :
            (languageService.getCurrentLanguage() === 'ka' ? 'არ არის ხელმისაწვდომი' : 'Not Available')
            }}
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoading">
      <div class="loading-spinner"></div>
      <p>{{ languageService.getCurrentLanguage() === 'ka' ? 'იტვირთება...' : 'Loading...' }}</p>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!isLoading && filteredProducts.length === 0">
      <div class="empty-icon">🎯</div>
      <h3>{{ languageService.getCurrentLanguage() === 'ka' ? 'პროდუქტები ვერ მოიძებნა' : 'No Products Found' }}</h3>
      <p>{{ languageService.getCurrentLanguage() === 'ka' ? 'სცადეთ სხვა ფილტრები ან საძიებო ტერმინი' : 'Try different filters or search terms' }}</p>
      <button class="clear-filters-btn" (click)="clearFilters()">
        {{ languageService.getCurrentLanguage() === 'ka' ? 'ფილტრების გასუფთავება' : 'Clear All Filters' }}
      </button>
    </div>
  </div>
</div>
